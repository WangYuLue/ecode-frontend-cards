### nginx 的作用

静态资源服务
  - 浏览器缓存
  - 防盗链
  - 资源压缩
  - 限流
代理服务
  - 正向代理
  - 反向代理
  - 负载均衡

### nginx 如何获取远程请求的 IP

```conf
location /myip {
	default_type text/plain;
	return 200 "$remote_addr";
}
```

### nginx 校验配置文件是否正确

校验默认配置文件：
```bash
nginx -t 
# out:
# nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
# nginx: configuration file /etc/nginx/nginx.conf test is successful
```

校验指定配置文件：
```bash
nginx -t -c [config-path]
```

### nginx 负载均衡如何配置？

```conf
http {
  upstream backserver {
    server 192.168.0.100:8080;
    server 192.168.0.101:8080;
    server example.com:8080;
  }

  server {
    listen 80;
    location / {
      proxy_pass http://backserver;
    }
  }
}
```

### nginx 负载均衡有哪些策略？

1、轮询
每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器 down 掉，能自动剔除：
```conf
upstream backserver {
  server 192.168.0.14;
  server 192.168.0.15;
}
```

2、权重
指定轮询几率，`weight` 和访问比率成正比，用于后端服务器性能不均的情况：
```conf
upstream backserver {
  server 192.168.0.14 weight=3;
  server 192.168.0.15 weight=7;
}
```

3、ip_hash
已经登录某一个服务器的用户再重新定位到另一个服务器，其登录信息将会丢失，这样显然是不妥的，这时候可以用 `ip_hash`：
```conf
upstream backserver {
  ip_hash;
  server 192.168.0.14:88;
  server 192.168.0.15:80;
}
```

### server_name 有什么作用？

在实际的生产环境，公网 ip 是很有限的，经常会出现一个 ip 多个业务系统公用，这时候就可以用 `server_name` 来匹配 http request header 里 host 字段，来实现同 ip 不同域名的需求。

例如：`domain.com` 和它的二级域名 `demo.domain.com` 配置在同一个公网 ip 上，这时候可以通过 `server_name` 来提供分别提供 http 服务：

```conf
http {
  server {
    listen 80;
    server_name domain.com;
    return 200 hello;
  }
  
  server {
    listen  80;
    server_name demo.domain.com;
    return 200 world;
  }
}
```

上面的配置请求 `domain.com` 会返回 hello，请求 `demo.domain.com` 会返回 world。

### 如何重启？

```bash
nginx -s reload
```

### alias 与 root 的区别？

**问题：**

在当前的 web server 的根路径下，需要配置 `/website` 来匹配系统路径下 `/usr/my-website/dist` 中的静态资源文件，需要如何配置？

**回答：**

可以使用别名来配置：

```conf
location /website {
  alias  /usr/my-website/dist;
  index  index.html index.htm;
}
```

上面的配置，很多人会将 `alias` 配置成 `root`，这样会有问题，这会导致网络请求 `/website` 下的资源文件时，实际请求的是 `/usr/my-website/dist/website` 路径下的资源文件，这会导致找不到文件而报 404。

所以这里需要使用别名来配置，换成 `alias` 时，请求 `/website` 下的资源文件时，可以正确请求到 `/usr/my-website/dist` 下的资源文件。

相关链接：
[stackoverflow question](https://stackoverflow.com/questions/41099318/nginx-location-404-not-found)


### nginx location 匹配规则

修饰符类型有下面 4 种：

- `=` 开头表示精确匹配，命中后不再进行后续的查找
- `^~` 开头表示 `uri` 以某个常规字符串开头，不是正则匹配，命中后不再进行后续的查找
- `~` 开头表示区分大小写的正则匹配
- `~*` 开头表示不区分大小写的正则匹配

当有多条 location 规则时，nginx 有一套比较复杂的规则，优先级如下：

`location =` > `location 完整路径` > `location ^~ 路径前缀` > `location ~*/~ 正则` > `location 路径前缀` > `/`

1. 精确匹配 `=`，命中后使用它的配置。
1. 查找是否有不带修饰符的完整匹配，如何命中，使用它的配置。
1. 前缀匹配 `^~`，命中后不再进行其他低优先级匹配，在精确匹配中选择最长匹配的项并使用它的配置。
1. 按文件中顺序的正则匹配 `~` 或 `~*`，如果匹配则停止查找，使用命中的配置。
1. 匹配不带任何修饰的前缀匹配，选择最长匹配的项并使用它的配置


相关链接：
[Nginx 匹配规则](https://www.jianshu.com/p/bc088f15276f)
[彻底弄懂 Nginx location 匹配](https://juejin.im/post/6844903849166110733)


### 基本配置方法

### nginx 常见优化方式

### 都说 nginx 性能高，为什么 nginx 性能这么高？

因为他是用来异步非阻塞事件处理机制：运用了epoll模型，提供了一个队列，排队相应请求。

### 如何配置 https